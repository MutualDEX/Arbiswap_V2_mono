{"code":"import { AbstractConnector } from '@web3-react/abstract-connector';\r\nimport invariant from 'tiny-invariant';\r\nexport const URI_AVAILABLE = 'URI_AVAILABLE';\r\nexport class UserRejectedRequestError extends Error {\r\n    constructor() {\r\n        super();\r\n        this.name = this.constructor.name;\r\n        this.message = 'The user rejected the request.';\r\n    }\r\n}\r\nexport class WalletConnectConnector extends AbstractConnector {\r\n    constructor({ rpc, bridge, qrcode, pollingInterval }) {\r\n        invariant(Object.keys(rpc).length === 1, '@walletconnect/web3-provider is broken with >1 chainId, please use 1');\r\n        super({ supportedChainIds: Object.keys(rpc).map(k => Number(k)) });\r\n        this.rpc = rpc;\r\n        this.bridge = bridge;\r\n        this.qrcode = qrcode;\r\n        this.pollingInterval = pollingInterval;\r\n        this.handleChainChanged = this.handleChainChanged.bind(this);\r\n        this.handleAccountsChanged = this.handleAccountsChanged.bind(this);\r\n        this.handleDisconnect = this.handleDisconnect.bind(this);\r\n    }\r\n    handleChainChanged(chainId) {\r\n        if (__DEV__) {\r\n            console.log(\"Handling 'chainChanged' event with payload\", chainId);\r\n        }\r\n        this.emitUpdate({ chainId });\r\n    }\r\n    handleAccountsChanged(accounts) {\r\n        if (__DEV__) {\r\n            console.log(\"Handling 'accountsChanged' event with payload\", accounts);\r\n        }\r\n        this.emitUpdate({ account: accounts[0] });\r\n    }\r\n    handleDisconnect() {\r\n        if (__DEV__) {\r\n            console.log(\"Handling 'disconnect' event\");\r\n        }\r\n        this.emitDeactivate();\r\n        // we have to do this because of a @walletconnect/web3-provider bug\r\n        if (this.walletConnectProvider) {\r\n            this.walletConnectProvider.stop();\r\n            this.walletConnectProvider.removeListener('chainChanged', this.handleChainChanged);\r\n            this.walletConnectProvider.removeListener('accountsChanged', this.handleAccountsChanged);\r\n            this.walletConnectProvider = undefined;\r\n        }\r\n        this.emitDeactivate();\r\n    }\r\n    async activate() {\r\n        if (!this.walletConnectProvider) {\r\n            const WalletConnectProvider = await import('@walletconnect/web3-provider').then(m => m?.default ?? m);\r\n            this.walletConnectProvider = new WalletConnectProvider({\r\n                bridge: this.bridge,\r\n                rpc: this.rpc,\r\n                qrcode: this.qrcode,\r\n                pollingInterval: this.pollingInterval\r\n            });\r\n        }\r\n        // ensure that the uri is going to be available, and emit an event if there's a new uri\r\n        if (!this.walletConnectProvider.wc.connected) {\r\n            await this.walletConnectProvider.wc.createSession({ chainId: Number(Object.keys(this.rpc)[0]) });\r\n            this.emit(URI_AVAILABLE, this.walletConnectProvider.wc.uri);\r\n        }\r\n        const account = await this.walletConnectProvider\r\n            .enable()\r\n            .then((accounts) => accounts[0])\r\n            .catch((error) => {\r\n            // TODO ideally this would be a better check\r\n            if (error.message === 'User closed modal') {\r\n                throw new UserRejectedRequestError();\r\n            }\r\n            throw error;\r\n        });\r\n        this.walletConnectProvider.on('disconnect', this.handleDisconnect);\r\n        this.walletConnectProvider.on('chainChanged', this.handleChainChanged);\r\n        this.walletConnectProvider.on('accountsChanged', this.handleAccountsChanged);\r\n        return { provider: this.walletConnectProvider, account };\r\n    }\r\n    async getProvider() {\r\n        return this.walletConnectProvider;\r\n    }\r\n    async getChainId() {\r\n        return this.walletConnectProvider.send('eth_chainId');\r\n    }\r\n    async getAccount() {\r\n        return this.walletConnectProvider.send('eth_accounts').then((accounts) => accounts[0]);\r\n    }\r\n    deactivate() {\r\n        if (this.walletConnectProvider) {\r\n            this.walletConnectProvider.stop();\r\n            this.walletConnectProvider.removeListener('disconnect', this.handleDisconnect);\r\n            this.walletConnectProvider.removeListener('chainChanged', this.handleChainChanged);\r\n            this.walletConnectProvider.removeListener('accountsChanged', this.handleAccountsChanged);\r\n        }\r\n    }\r\n    async close() {\r\n        await this.walletConnectProvider?.close();\r\n    }\r\n}\r\n//# sourceMappingURL=index.js.map","references":["/Users/dzack/web3-react/packages/walletconnect-connector/node_modules/@web3-react/types/dist/index.d.ts","/Users/dzack/web3-react/packages/walletconnect-connector/node_modules/@web3-react/abstract-connector/dist/index.d.ts","/Users/dzack/web3-react/packages/walletconnect-connector/node_modules/tiny-invariant/dist/tiny-invariant.d.ts","/Users/dzack/web3-react/packages/walletconnect-connector/node_modules/@walletconnect/web3-provider/dist/cjs/index.d.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/index.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/dzack/web3-react/packages/walletconnect-connector/src/index.d.ts","writeByteOrderMark":false,"text":"import { ConnectorUpdate } from '@web3-react/types';\r\nimport { AbstractConnector } from '@web3-react/abstract-connector';\r\nexport declare const URI_AVAILABLE = \"URI_AVAILABLE\";\r\nexport declare class UserRejectedRequestError extends Error {\r\n    constructor();\r\n}\r\ninterface WalletConnectConnectorArguments {\r\n    rpc: {\r\n        [chainId: number]: string;\r\n    };\r\n    bridge?: string;\r\n    qrcode?: boolean;\r\n    pollingInterval?: number;\r\n}\r\nexport declare class WalletConnectConnector extends AbstractConnector {\r\n    private readonly rpc;\r\n    private readonly bridge?;\r\n    private readonly qrcode?;\r\n    private readonly pollingInterval?;\r\n    walletConnectProvider?: any;\r\n    constructor({ rpc, bridge, qrcode, pollingInterval }: WalletConnectConnectorArguments);\r\n    private handleChainChanged;\r\n    private handleAccountsChanged;\r\n    private handleDisconnect;\r\n    activate(): Promise<ConnectorUpdate>;\r\n    getProvider(): Promise<any>;\r\n    getChainId(): Promise<number | string>;\r\n    getAccount(): Promise<null | string>;\r\n    deactivate(): void;\r\n    close(): Promise<void>;\r\n}\r\nexport {};\r\n"}}
